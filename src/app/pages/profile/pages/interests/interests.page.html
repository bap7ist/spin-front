<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <div class="back-button-container">
        <ion-button class="custom-back-button" (click)="goBack()">
          <ion-icon name="chevron-back-outline"></ion-icon>
        </ion-button>
      </div>
    </ion-buttons>
    <ion-title>Centres d'intérêt</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  @if (allInterests.length > 0) {
  <div class="interests-container">
    <div class="interests-counter">
      {{ selectedInterests.length }} intérêts sélectionnés
    </div>

    @for (category of categories; track category; let i = $index) {
    <div class="category-section">
      <h2 class="category-title">{{ category | titlecase }}</h2>

      <div class="interests-grid">
        @for (interest of getInterestsByCategory(category); track interest.name)
        {
        <ion-chip
          class="interest-chip"
          [class.selected]="isSelected(interest.name)"
          [attr.data-category-index]="i"
          (click)="toggleInterest(interest.name)"
        >
          <ion-label>{{ interest.name }}</ion-label>
        </ion-chip>
        }
      </div>
    </div>
    }
  </div>
  } @else {
  <div class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Chargement des centres d'intérêt...</p>
  </div>
  }
</ion-content>

<!-- Bouton flottant fixe en bas -->
<div
  class="floating-button"
  [ngClass]="{'hidden': !isButtonVisible}"
  (click)="saveInterests()"
>
  @if (isSaving) {
  <ion-spinner></ion-spinner>
  } @else {
  <ion-icon name="checkmark"></ion-icon>}
</div>
